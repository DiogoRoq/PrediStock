<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previs√£o de Procura</title>
    <link rel="stylesheet" href="main.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="JavaScript/demandPrediction.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="profile">
                <img src="imagem-usuario.png" alt="Icon" class="avatar">
            </div>
            <nav class="menu">
                <button class="menu-item" onclick="location.href='dashboard.html'">Dashboard Principal</button>
                <button class="menu-item" onclick="location.href='inventoryManagement.html'">Gest√£o de Produtos</button>
                <button class="menu-item" onclick="location.href='demandPrediction.html'">Previs√£o de Procura</button>
                <button class="menu-item" onclick="location.href='analytics.html'">Relat√≥rios e Estat√≠sticas</button>
            </nav>
        </aside>
        <div class="dashboard-content">
            <h3>Model Status: <span id="model-status">Loading...</span></h3>
            <button class="btn-primary" onclick="predictDemand()">Predict Demand</button>
            <p id="prediction-note" style="font-style: italic; color: #555; margin-top: 20px;">
                üîç The predicted demand represents <strong>weekly sales per product</strong> based on current stock.
            </p>
            
            <div id="prediction-results"></div>
        </div>
    </div>
</body>
<script>
document.addEventListener("DOMContentLoaded", function () {
  checkModelStatus();
});

function checkModelStatus() {
  fetch('http://127.0.0.1:5000/model-status')
    .then(res => res.json())
    .then(data => {
      const status = data.trained ? "‚úÖ Trained" : "‚ùå Not Trained";
      document.getElementById('model-status').innerText = status;
    })
    .catch(err => {
      console.error("Error checking model status:", err);
      document.getElementById('model-status').innerText = '‚ö†Ô∏è Error';
    });
}

function predictDemand() {
  fetch('http://127.0.0.1:5000/predict-demand')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not OK');
      }
      return response.json();
    })
    .then(data => {
      const container = document.getElementById('prediction-results');

      if (data.error) {
        container.innerHTML = `<p style="color:red;">Error: ${data.error}</p>`;
        return;
      }

      if (!Array.isArray(data) || data.length === 0) {
        container.innerHTML = `<p>No predictions returned.</p>`;
        return;
      }

      
      const headers = ['product_name', 'predicted_units_sold'];

      let html = '<h3>Predicted Demand</h3><table border="1" cellpadding="5"><tr>';
      headers.forEach(h => {
        html += `<th>${h}</th>`;
      });
      html += '</tr>';

      data.forEach(row => {
        html += '<tr>';
        headers.forEach(h => {
          html += `<td>${row[h]}</td>`;
        });
        html += '</tr>';
      });

      html += '</table>';
      container.innerHTML = html;
    })
    .catch(err => {
      console.error("Prediction request failed:", err);
      document.getElementById('prediction-results').innerHTML =
        `<p style="color:red;">Request failed: ${err}</p>`;
    });
}
</script>
</html>